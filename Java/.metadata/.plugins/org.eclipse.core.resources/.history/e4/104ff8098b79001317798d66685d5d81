package pl.edu.agh.monitordb.test;


import static org.junit.Assert.*;

import java.util.Iterator;
import java.util.List;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import pl.edu.agh.monitordb.MonitorService;
import pl.edu.agh.monitordb.Users;
import pl.edu.agh.monitordb.Values;

import org.hibernate.HibernateException;
import org.hibernate.Transaction;
import org.hibernate.Session;
import org.hibernate.SessionFactory;
import org.hibernate.cfg.AnnotationConfiguration;
import org.hibernate.cfg.Configuration;
import org.hibernate.service.*;
import org.hibernate.Criteria;
import org.hibernate.criterion.Restrictions;


public class MonitorServiceTest {

	private SessionFactory sessionFactory;
	private Session session;
	
	@Before
	public void before() {
		sessionFactory = createSessionFactory();
		session = sessionFactory.openSession();
		//Transaction transaction = session.beginTransaction();
	}
	
	@After
	public void after() {
		session.close();
		sessionFactory.close();
	}
	
	@Test
	public void testAddData() {
		
		Integer y = new Integer(2013);
		Integer m = new Integer(12);
		Integer d = new Integer(24); 
		Integer h = new Integer(18); 
		Integer min = new Integer(20); 
		Float s = new Float(45.45); 
		String comp = new String("TestComputer"); 
		String counter = new String("CPUTest");
		Float val = new Float(44.44444);
		String verify = new String("test");
		
		MonitorService monitorService = new MonitorService();
		
		monitorService.addData(y, m, d, h, min, s, comp, counter, val, verify);
		
		
		Transaction transaction = session.beginTransaction();
        List<Values> values = session.createQuery("FROM Values WHERE Computer = 'TestComputer'").list(); 
        //for (Iterator iterator = values.iterator(); iterator.hasNext();)
        //{
        //	Values value = (Values) iterator.next();  
        //}
        assertNotNull(values);
        assertEquals(1, values.size());
        transaction.commit();
	 
		
	}
	
	
	@SuppressWarnings("deprecation")
	private SessionFactory createSessionFactory() {
		
		@SuppressWarnings("deprecation")
		AnnotationConfiguration configuration = new AnnotationConfiguration();
		  configuration.addAnnotatedClass(Values.class)
		    .addAnnotatedClass(Users.class);
		  configuration.setProperty("hibernate.dialect",
		    "org.hibernate.dialect.H2Dialect");
		  configuration.setProperty("hibernate.connection.driver_class",
		    "org.h2.Driver");
		  configuration.setProperty("hibernate.connection.url", "jdbc:h2:mem");
		  configuration.setProperty("hibernate.hbm2ddl.auto", "create");
		
		  sessionFactory = configuration.buildSessionFactory();
		  session = sessionFactory.openSession();
		return sessionFactory;
	}
	
	
	
}
